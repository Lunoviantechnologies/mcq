{% extends 'base.html' %}
{% load quiz_extras %}

{% block title %}Quiz Results - {{ quiz.title }}{% endblock %}

{% block extra_css %}
<style>
    .results-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        padding: 3rem;
        border-radius: 16px;
        margin-bottom: 2rem;
        text-align: center;
        box-shadow: var(--shadow-xl);
    }
    
    .results-header h2 {
        font-size: 2rem;
        margin-bottom: 1.5rem;
        color: white;
    }
    
    .score-display {
        font-size: 4rem;
        font-weight: 700;
        margin: 1.5rem 0;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    
    .results-header p {
        opacity: 0.95;
        font-size: 1rem;
    }
    
    .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--gray-lighter);
    }
    
    .question-result {
        border: 2px solid var(--gray-lighter);
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        background: var(--white);
        transition: all 0.3s;
        box-shadow: var(--shadow-sm);
    }
    
    .question-result:hover {
        box-shadow: var(--shadow-md);
    }
    
    .question-result.correct {
        border-color: var(--success-color);
        background: linear-gradient(90deg, rgba(16, 185, 129, 0.05), rgba(16, 185, 129, 0.02));
    }
    
    .question-result.incorrect {
        border-color: var(--danger-color);
        background: linear-gradient(90deg, rgba(239, 68, 68, 0.05), rgba(239, 68, 68, 0.02));
    }
    
    .question-result.text-answer {
        border-color: var(--warning-color);
        background: linear-gradient(90deg, rgba(245, 158, 11, 0.05), rgba(245, 158, 11, 0.02));
    }
    
    .question-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .question-label {
        font-weight: 600;
        font-size: 1.1rem;
        color: var(--dark);
        flex: 1;
        line-height: 1.5;
    }
    
    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-size: 0.875rem;
        font-weight: 600;
        white-space: nowrap;
    }
    
    .status-badge.correct {
        background: var(--success-color);
        color: white;
        box-shadow: var(--shadow-sm);
    }
    
    .status-badge.incorrect {
        background: var(--danger-color);
        color: white;
        box-shadow: var(--shadow-sm);
    }
    
    .status-badge.text {
        background: var(--warning-color);
        color: white;
        box-shadow: var(--shadow-sm);
    }
    
    .answer-section {
        margin-top: 1rem;
    }
    
    .answer-display {
        margin: 0.75rem 0;
        padding: 1rem 1.25rem;
        background: var(--white);
        border-radius: 10px;
        border: 1px solid var(--gray-lighter);
    }
    
    .answer-display strong {
        display: block;
        margin-bottom: 0.5rem;
        color: var(--gray);
        font-size: 0.875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .answer-text {
        font-size: 1rem;
        color: var(--dark);
        line-height: 1.6;
    }
    
    .correct-answer {
        color: var(--success-color);
        font-weight: 600;
    }
    
    .incorrect-answer {
        color: var(--danger-color);
        font-weight: 500;
    }
    
    .actions-section {
        text-align: center;
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 2px solid var(--gray-lighter);
    }
</style>
{% endblock %}

{% block content %}
<div class="results-header">
    <h2>{{ quiz.title }}</h2>
    <div class="score-display">{{ submission.score|floatformat:1 }}%</div>
    <p>Submitted on: {{ submission.submitted_at|date:"F d, Y g:i A" }}</p>
</div>

<h3 class="section-title">Your Answers Review</h3>

{% for question in questions %}
{% with answers_dict|get_item:question.id as answer %}
<div class="question-result 
    {% if question.question_type == 'multiple_choice' %}
        {% if answer and answer.selected_choice %}
            {% if answer.selected_choice.is_correct %}correct{% else %}incorrect{% endif %}
        {% endif %}
    {% else %}text-answer{% endif %}">
    <div class="question-header">
        <div class="question-label">
            <strong>Question {{ forloop.counter }}:</strong> {{ question.question_text }}
        </div>
        {% if question.question_type == 'multiple_choice' and answer and answer.selected_choice %}
            {% if answer.selected_choice.is_correct %}
                <span class="status-badge correct">‚úì Correct</span>
            {% else %}
                <span class="status-badge incorrect">‚úó Incorrect</span>
            {% endif %}
        {% elif question.question_type == 'text' %}
            <span class="status-badge text">üìù Text Answer</span>
        {% endif %}
    </div>
    
    <div class="answer-section">
        {% if question.question_type == 'multiple_choice' %}
            {% if answer %}
                {% if answer.selected_choice %}
                    <div class="answer-display">
                        <strong>Your Answer:</strong>
                        <div class="answer-text {% if answer.selected_choice.is_correct %}correct-answer{% else %}incorrect-answer{% endif %}">
                            {{ answer.selected_choice.choice_text }}
                        </div>
                    </div>
                    {% if not answer.selected_choice.is_correct %}
                        <div class="answer-display">
                            <strong>Correct Answer:</strong>
                            <div class="answer-text correct-answer">
                                {% for choice in question.choices.all %}
                                    {% if choice.is_correct %}{{ choice.choice_text }}{% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="answer-display">
                        <div class="answer-text incorrect-answer">No answer provided</div>
                    </div>
                {% endif %}
            {% else %}
                <div class="answer-display">
                    <div class="answer-text incorrect-answer">No answer provided</div>
                </div>
            {% endif %}
        {% else %}
            <div class="answer-display">
                <strong>Your Answer:</strong>
                <div class="answer-text">
                    {% if answer and answer.answer_text %}
                        {{ answer.answer_text }}
                    {% else %}
                        <span class="incorrect-answer">No answer provided</span>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endwith %}
{% endfor %}

<div class="actions-section">
    <a href="{% url 'quiz_list' %}" class="btn btn-lg">Back to Quizzes</a>
</div>
{% endblock %}
